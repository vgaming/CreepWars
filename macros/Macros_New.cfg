{~add-ons/Creep_War/macros/Macros.cfg}
#define Start_Message_new
"
Welcome to Creep War!
On this map, each player controls a single hero and fights for a team, East or West.  The game ends when one team kills one of the opposing team's guards.  At the shop, you can buy upgrades for your hero, including HP, damage, movement, , armour, and resistances.  Visiting the shop will also heal your hero completely.  Each turn, creeps are created in your team's castle until your side has 8.  The strength of the creeps created increases with your team's score.  Killing a creep gives your team +1 score; killing a Hero gives +3 score; simply attacking an opposing guard also gives +1 score. When your team kills a creep, everyone on your team gets 4 gold. Whenever a hero dies, everyone on the opposing team gets 20 gold.  If your hero dies, you will lose your next turn and start back in your team's cave.

Have Fun!

Creep War 0.3.00
Written by Blitzmerker and piezocuttlefish"
#enddef

#define create_CW_Guard_new team number x y side
	[unit]
		type=Lieutenant
		id=CW_Guard_{team}{number}
		name=Guard
		side={side}
		x={x}
		y={y}
		random_traits=no
		canrecruit=yes
		[modifications]
			[object]
				[effect] 
					apply_to=hitpoints 
					increase_total=10
					heal_full=yes
				[/effect]
				[effect] 
					apply_to=attack
					range=melee
					increase_damage=-3
					increase_attacks=1
				[/effect]
				[effect]
					apply_to=attack
					range=ranged
					increase_damage=0
					increase_attacks=1
				[/effect]
				[effect]
					apply_to=max_experience
					increase=99920
				[/effect]
				[effect]
					apply_to=movement
					set=0
				[/effect]
				[effect]
					apply_to=resistance
					replace=true
					[resistance]
						blade=100
						cold=100
						fire=100
						impact=100
						pierce=100
						arcane=100
					[/resistance]
				[/effect]
			[/object]
		[/modifications]
		to_variable=guard_var
	[/unit]
	[set_variable]
		name=guard_var.alignment
		value=neutral
	[/set_variable]
	[unstore_unit]
		variable=guard_var
	[/unstore_unit]
#enddef
#define attack_CW_Guard kill team number Guardteam Guardside
	[event]
		name=attack
		first_time_only=no
		[filter_second]
			side={Guardside}
			type=Lieutenant
			id=CW_Guard_{Guardteam}{number}
		[/filter_second]
		[set_variable]
			name={kill}
			add=1
		[/set_variable]
		{update_score}
		[object]
			silent=yes
			[filter]
				id=CW_Guard_{team}1
			[/filter]
			[effect]
				apply_to=hitpoints
				increase_total=1
				increase=1
			[/effect]
		[/object]
		[object]
			silent=yes
			[filter]
				id=CW_Guard_{team}2
			[/filter]
			[effect]
				apply_to=hitpoints
				increase_total=1
				increase=1
			[/effect]
		[/object]
[/event]
#enddef
#define creep_die_new enemy1 enemy2 enemy3 kill team side new_creep_for
	[event]
		name=die
		first_time_only=no
		[filter]
			side={side}
			[not]
				type=Lieutenant
			[/not]
		[/filter]
		[gold]
			side={enemy1}
			amount=4
		[/gold]
		[gold]
			side={enemy2}
			amount=4
		[/gold]
		[gold]
			side={enemy3}
			amount=4
		[/gold]
		[set_variable]
			name=gold_{team}
			add=4
		[/set_variable]
		[set_variable]
			name={kill}
			add=1
		[/set_variable]
		[set_variable]
			name={new_creep_for}
			add=1
		[/set_variable]
		[object]
			silent=yes
			[filter]
				id=CW_Guard_{team}1
			[/filter]
			[effect]
				apply_to=hitpoints
				increase_total=1
				increase=1
			[/effect]
		[/object]
		[object]
			silent=yes
			[filter]
				id=CW_Guard_{team}2
			[/filter]
			[effect]
				apply_to=hitpoints
				increase_total=1
				increase=1
			[/effect]
		[/object]
		{VARIABLE_OP guard_{team}_plus_hitpoints add 1}
		{update_score}
	[/event]
#enddef
#define CW_Guard_die_new winside1 winside2 winside3 x1 x2 x3 y side1 side2 side3 side 
	[event]
		name=die
		[filter]
			side={side}
			canrecruit=yes
		[/filter]
		[if]
			[variable]
				name=hero_{winside1}
				equals=dead
			[/variable]
			[or]
				[variable]
					name=hero_{winside1}
					equals=dead_wait
				[/variable]
			[/or]
			[then]
				[unstore_unit]
					variable=dead_hero_{winside1}
					x={x1}
					y={y}
					find_vacant=yes
				[/unstore_unit]
			[/then]
		[/if]
		[if]
			[variable]
				name=hero_{winside2}
				equals=dead
			[/variable]
			[or]
				[variable]
					name=hero_{winside2}
					equals=dead_wait
				[/variable]
			[/or]
			[then]
				[unstore_unit]
					variable=dead_hero_{winside2}
					x={x2}
					y={y}
					find_vacant=yes
				[/unstore_unit]
			[/then]
		[/if]
		[if]
			[variable]
				name=hero_{winside3}
				equals=dead
			[/variable]
			[or]
				[variable]
					name=hero_{winside3}
					equals=dead_wait
				[/variable]
			[/or]
			[then]
				[unstore_unit]
					variable=dead_hero_{winside3}
					x={x3}
					y={y}
					find_vacant=yes
				[/unstore_unit]
			[/then]
		[/if]
		[kill]
			side={side}
		[/kill]
		[kill]
			side={side1}
		[/kill]
		[kill]
			side={side2}
		[/kill]
		[kill]
			side={side3}
		[/kill]
	[/event]
#enddef
#define new_creep_new greater_than_equal_to less_than_equal_to kill team number type1 type2 type3 x y find1 find2 find3 find4 find5 find6 find7 increase_damage increase_strikes increase_mp side
	[event]
		name=side turn
		first_time_only=no
		[if]
			[not]
				[variable]
					name=team_{team}
					equals=dead
				[/variable]
			[/not]
			[variable]
				name=side_number
				equals={side}
			[/variable]
			[variable]
				name={kill}
				greater_than_equal_to={greater_than_equal_to}
			[/variable]
			[variable]
				name={kill}
				less_than={less_than_equal_to}
			[/variable]
			[then]
				[set_variable]
					name=spwaned_creeps
					value=0
				[/set_variable]
				[while]
					[variable]
						name=spwaned_creeps
						less_than=${number}
					[/variable]
					[do]
						[set_variable]
							name=random_creep
							rand=1,2,3
						[/set_variable]
						[if]
							[variable]
								name=random_creep
								equals=1
							[/variable]
							[then]
								[unit]
									side={side}
									type={type1}
									x={x}
									y={y}
									random_gender=yes
									[modifications]
										[object]
											silent=yes
											[effect]
												apply_to=zoc
												value=no
											[/effect]
										[/object]
									[/modifications]
									to_variable=creep
								[/unit]
							[/then]
						[/if]
						[if]
							[variable]
								name=random_creep
								equals=2
							[/variable]
							[then]
								[unit]
									side={side}
									type={type2}
									x={x}
									y={y}
									random_gender=yes
									[modifications]
										[object]
											silent=yes
											[effect]
												apply_to=zoc
												value=no
											[/effect]
										[/object]
									[/modifications]
									to_variable=creep
								[/unit]
							[/then]
						[/if]
						[if]
							[variable]
								name=random_creep
								equals=3
							[/variable]
							[then]
								[unit]
									side={side}
									type={type3}
									x={x}
									y={y}
									random_gender=yes
									[modifications]
										[object]
											silent=yes
											[effect]
												apply_to=zoc
												value=no
											[/effect]
										[/object]
									[/modifications]
									to_variable=creep
								[/unit]
							[/then]
						[/if]
						[set_variable]
							name=addhp
							value={less_than_equal_to}
						[/set_variable]
						[set_variable]
							name=addhp
							add=-90
						[/set_variable]
						[set_variable]
							name=adddmg
							value=0
						[/set_variable]
						[set_variable]
							name=addatk
							value=0
						[/set_variable]
						[if]
							[variable]
								name=addhp
								greater_than=0
							[/variable]
							[then]
								[set_variable]
									name=creep.max_hitpoints
									add=$addhp
								[/set_variable]
								[set_variable]
									name=creep.hitpoints
									add=$addhp
								[/set_variable]
								[set_variable]
									name=adddmg
									value=$addhp
								[/set_variable]
								[set_variable]
									name=addmp
									value=$addhp
								[/set_variable]
								[set_variable]
									name=adddmg
									multiply=0.0625
								[/set_variable]
								[set_variable]
									name=addatk
									value=$addhp
								[/set_variable]
								[set_variable]
									name=addatk
									multiply=0.034
								[/set_variable]
								[set_variable]
									name=addmp
									multiply=0.034
								[/set_variable]
								[set_variable]
									name=creep.max_moves
									add=$addmp
								[/set_variable]
								[set_variable]
									name=creep.moves
									add=$addhp
								[/set_variable]
							[/then]
						[/if]
					
						{FOREACH creep.attack i}
							{VARIABLE_OP creep.attack[$i].damage add {increase_damage}}
							{VARIABLE_OP creep.attack[$i].damage add $adddmg}
						{NEXT i}
						{FOREACH creep.attack i}
							{VARIABLE_OP creep.attack[$i].number add {increase_strikes}}
							{VARIABLE_OP creep.attack[$i].number add $addatk}
						{NEXT i}
						{VARIABLE_OP creep.max_moves add {increase_mp}}
						[store_locations]
							x={x}
							y={y}
							radius=2
							variable=find_place
						[/store_locations]
						[if]
							[have_unit]
								x={x}
								y={y}
							[/have_unit]
							[then]
								[if]
									[have_unit]
										x=$find_place[{find1}].x
										y=$find_place[{find1}].y
									[/have_unit]
									[then]
										[if]
											[have_unit]
												x=$find_place[{find2}].x
												y=$find_place[{find2}].y
											[/have_unit]
											[then]
												[if]
													[have_unit]
														x=$find_place[{find3}].x
														y=$find_place[{find3}].y
													[/have_unit]
													[then]
														[if]
															[have_unit]
																x=$find_place[{find4}].x
																y=$find_place[{find4}].y
															[/have_unit]
															[then]
																[if]
																	[have_unit]
																		x=$find_place[{find5}].x
																		y=$find_place[{find5}].y
																	[/have_unit]
																	[then]
																		[if]
																			[have_unit]
																				x=$find_place[{find6}].x
																				y=$find_place[{find6}].y
																			[/have_unit]
																			[then]
																				[if]
																					[have_unit]
																						x=$find_place[{find7}].x
																						y=$find_place[{find7}].y
																					[/have_unit]
																					[then]
																						[unstore_unit]
																							variable=creep
																							find_vacant=yes
																						[/unstore_unit]
																					[/then]
																					[else]
																						[unstore_unit]
																							variable=creep
																							x=$find_place[{find7}].x
																							y=$find_place[{find7}].y
																						[/unstore_unit]
																					[/else]
																				[/if]
																			[/then]
																			[else]
																				[unstore_unit]
																					variable=creep
																					x=$find_place[{find6}].x
																					y=$find_place[{find6}].y
																				[/unstore_unit]
																			[/else]
																		[/if]
																	[/then]
																	[else]
																		[unstore_unit]
																			variable=creep
																			x=$find_place[{find5}].x
																			y=$find_place[{find5}].y
																		[/unstore_unit]
																	[/else]
																[/if]
															[/then]
															[else]
																[unstore_unit]
																	variable=creep
																	x=$find_place[{find4}].x
																	y=$find_place[{find4}].y
																[/unstore_unit]
															[/else]
														[/if]
													[/then]
													[else]
														[unstore_unit]
															variable=creep
															x=$find_place[{find3}].x
															y=$find_place[{find3}].y
														[/unstore_unit]
													[/else]
												[/if]
											[/then]
											[else]
												[unstore_unit]
													variable=creep
													x=$find_place[{find2}].x
													y=$find_place[{find2}].y
												[/unstore_unit]
											[/else]
										[/if]
									[/then]
									[else]
										[unstore_unit]
											variable=creep
											x=$find_place[{find1}].x
											y=$find_place[{find1}].y
										[/unstore_unit]
									[/else]
								[/if]
							[/then]
							[else]
								[unstore_unit]
									variable=creep
									x={x}
									y={y}
								[/unstore_unit]
							[/else]
						[/if]
						[set_variable]
							name=spwaned_creeps
							add=1
						[/set_variable]
					[/do]
				[/while]
				[set_variable]
					name={number}
					value=0
				[/set_variable]
			[/then]
		[/if]
	[/event]
#enddef
#define CW_HELP_MENU
	[set_menu_item]
		id=Zhelp
		description= _ "Help"
		[command]
			[message]
				speaker=narrator
				side_for=$side_number
				message= _ {Start_Message_new}
				[option]
					message= _ "close"
				[/option]
				[option]
					message= _ "FAQ"
					[command]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "<span color='#00FF00'>What is the goal of this game?</span>
<span size='small'>The goal is to kill either guard of the opposing team.</span>
<span color='#00FF00'>How do I enter the shop?</span>
<span size='small'>Move on it, right click on your hero, and select 'Enter Shop'.</span>
<span color='#00FF00'>How do I get gold?</span>
<span size='small'>Killing a creep gives your team 4 gold.  Killing an enemy hero gives 20.</span>
<span color='#00FF00'>What if I die?</span>
<span size='small'>You lose one turn, then start again in your team's cave.</span>
<span color='#00FF00'>What is that score counter for?</span>
<span size='small'>A team gets more powerful creeps every 15 score.  After 90, there will be no new creep types—they will just get stronger.</span>
<span color='#00FF00'>Why can't I buy a suit of armour?</span>
<span size='small'>You start with 10 resistance upgrades, and buying a suit of armour costs some or all of those.</span>
<span color='#00FF00'>Can I visit the enemy's shop?</span>
<span size='small'>No.</span>"
						[/message]
					[/command]
				[/option]
				[option]
					message= _ "changelog"
					[command]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "{~add-ons/Creep_War/changelog}"
						[/message]
					[/command]
				[/option]
			[/message]
		[/command]
	[/set_menu_item]
#enddef
