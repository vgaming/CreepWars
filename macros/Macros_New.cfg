{~add-ons/Creep_War/macros/Macros.cfg}
#define Start_Message_new
"On this map, each player controls a single hero and fights for a team, East or West.  The game ends when one team kills one of the opposing team's guards.  At the shop, you can buy upgrades for your hero, including HP, damage, movement, , armour, and resistances.  Visiting the shop will also heal your hero completely.  Each turn, creeps are created in your team's castle until your side has 8.  The strength of the creeps created increases with your team's score.  Killing a creep gives your team +1 score; killing a Hero gives +3 score; simply attacking an opposing guard also gives +1 score. When your team kills a creep, everyone on your team gets 4 gold. Whenever a hero dies, everyone on the opposing team gets 20 gold.  If your hero dies, you will lose your next turn and start back in your team's cave.

Have Fun!

Creep War 0.3.00
Written by Blitzmerker and piezocuttlefish"
#enddef

#define attack_CW_Guard kill team number Guardteam Guardside
[event]
	name=attack
	first_time_only=no
	[filter_second]
		side={Guardside}
		type=Lieutenant
		id=CW_Guard_{Guardteam}{number}
		[/filter_second]
	{VARIABLE_OP {kill} add 1}
	{CW_UPDATE_SCORE}
	{CW_UNIT_GUARD_INCREASE_HP {team} 1 1}
	{CW_UNIT_GUARD_INCREASE_HP {team} 2 1}
	[/event]
#enddef

#define creep_die_new enemy1 enemy2 enemy3 kill team side new_creep_for
	[event]
		name=die
		first_time_only=no
		[filter]
			side={side}
			[not]
				type=Lieutenant
				[/not]
			[/filter]
		{CW_ADD_GOLD {enemy1} 4}
		{CW_ADD_GOLD {enemy2} 4}
		{CW_ADD_GOLD {enemy3} 4}
		{VARIABLE_OP gold_{team} add 4}
		{VARIABLE_OP {kill} add 1}
		{VARIABLE_OP {new_creep_for} add 1}
		{CW_UNIT_GUARD_INCREASE_HP {team} 1 1}
		{CW_UNIT_GUARD_INCREASE_HP {team} 2 1}
		{VARIABLE_OP guard_{team}_plus_hitpoints add 1}
		{CW_UPDATE_SCORE}
	[/event]
#enddef
#define CW_Guard_die_new winside1 winside2 winside3 x1 x2 x3 y SIDE_LOSE_1 SIDE_LOSE_2 SIDE_LOSE_3 SIDE_LOSE_CREEPS
	[event]
		name=die
		[filter]
			side={SIDE_LOSE_CREEPS}
			canrecruit=yes
		[/filter]
		[if]
			[variable]
				name=hero_{winside1}
				equals=dead
			[/variable]
			[or]
				[variable]
					name=hero_{winside1}
					equals=dead_wait
				[/variable]
			[/or]
			[then]
				[unstore_unit]
					variable=dead_hero_{winside1}
					x={x1}
					y={y}
					find_vacant=yes
				[/unstore_unit]
			[/then]
		[/if]
		[if]
			[variable]
				name=hero_{winside2}
				equals=dead
			[/variable]
			[or]
				[variable]
					name=hero_{winside2}
					equals=dead_wait
				[/variable]
			[/or]
			[then]
				[unstore_unit]
					variable=dead_hero_{winside2}
					x={x2}
					y={y}
					find_vacant=yes
				[/unstore_unit]
			[/then]
		[/if]
		[if]
			[variable]
				name=hero_{winside3}
				equals=dead
			[/variable]
			[or]
				[variable]
					name=hero_{winside3}
					equals=dead_wait
				[/variable]
			[/or]
			[then]
				[unstore_unit]
					variable=dead_hero_{winside3}
					x={x3}
					y={y}
					find_vacant=yes
				[/unstore_unit]
			[/then]
		[/if]
		{CW_KILL_SIDE {SIDE_LOSE_CREEPS}}
		{CW_KILL_SIDE {SIDE_LOSE_1}}
		{CW_KILL_SIDE {SIDE_LOSE_2}}
		{CW_KILL_SIDE {SIDE_LOSE_3}}
	[/event]
#enddef
#define new_creep_new LB_KILLS UB_KILLS KILLS team number type1 type2 type3 x y find1 find2 find3 find4 find5 find6 find7 increase_damage increase_strikes increase_mp side
	[event]
		name=side turn
		first_time_only=no
		[if]
			{VARIABLE_CONDITIONAL team_{team} not_equals dead}
			{VARIABLE_CONDITIONAL side_number equals {side}}
			{VARIABLE_CONDITIONAL {KILLS} greater_than_equal_to {LB_KILLS}}
			{VARIABLE_CONDITIONAL {KILLS} less_than {UB_KILLS}}
			[then]
				{VARIABLE spawned_creeps 0}
				[while]
					{VARIABLE_CONDITIONAL spawned_creeps less_than ${number}}
					[do]
						[set_variable]
							name=random_creep
							rand=1,2,3
						[/set_variable]
						[if]
							{VARIABLE_CONDITIONAL random_creep equals 1}
							[then]
								[unit]
									side={side}
									type={type1}
									x={x}
									y={y}
									random_gender=yes
									[modifications]
										[object]
											silent=yes
											[effect]
												apply_to=zoc
												value=no
											[/effect]
										[/object]
									[/modifications]
									to_variable=creep
								[/unit]
							[/then]
						[/if]
						[if]
							{VARIABLE_CONDITIONAL random_creep equals 2}
							[then]
								[unit]
									side={side}
									type={type2}
									x={x}
									y={y}
									random_gender=yes
									[modifications]
										[object]
											silent=yes
											[effect]
												apply_to=zoc
												value=no
											[/effect]
										[/object]
									[/modifications]
									to_variable=creep
								[/unit]
							[/then]
						[/if]
						[if]
							{VARIABLE_CONDITIONAL random_creep equals 3}
							[then]
								[unit]
									side={side}
									type={type3}
									x={x}
									y={y}
									random_gender=yes
									[modifications]
										[object]
											silent=yes
											[effect]
												apply_to=zoc
												value=no
											[/effect]
										[/object]
									[/modifications]
									to_variable=creep
								[/unit]
							[/then]
						[/if]
						{VARIABLE addhp {KILLS}}
						{VARIABLE_OP addhp sub 90}
						[if]
							{VARIABLE_CONDITIONAL addhp greater_than 0}
							[then]
								{VARIABLE_OP creep.max_hitpoints add $addhp}
								{VARIABLE_OP creep.hitpoints add $addhp}
								{VARIABLE adddmg $addhp}
								{VARIABLE addatk $addhp}
								{VARIABLE_OP adddmg multiply 0.0625}
								{VARIABLE_OP addatk multiply 0.0334}		# addatk doubles as addmp since the formula is the same
								{VARIABLE_OP creep.max_moves add $addatk}
								{VARIABLE_OP creep.moves add $addatk}		# typo fixed
								[/then]
							[else]
								{VARIABLE adddmg 0}
								{VARIABLE addatk 0}
								[/else]
							[/if]
						{FOREACH creep.attack i}
							{VARIABLE_OP creep.attack[$i].damage add {increase_damage}}
							{VARIABLE_OP creep.attack[$i].damage add $adddmg}
						{NEXT i}
						{FOREACH creep.attack i}
							{VARIABLE_OP creep.attack[$i].number add {increase_strikes}}
							{VARIABLE_OP creep.attack[$i].number add $addatk}
						{NEXT i}
						{VARIABLE_OP creep.max_moves add {increase_mp}}
						[store_locations]
							x={x}
							y={y}
							radius=2
							variable=find_place
							[/store_locations]
						[if]
							[have_unit]
								x={x}
								y={y}
							[/have_unit]
							[then]
								[if]
									[have_unit]
										x=$find_place[{find1}].x
										y=$find_place[{find1}].y
									[/have_unit]
									[then]
										[if]
											[have_unit]
												x=$find_place[{find2}].x
												y=$find_place[{find2}].y
											[/have_unit]
											[then]
												[if]
													[have_unit]
														x=$find_place[{find3}].x
														y=$find_place[{find3}].y
													[/have_unit]
													[then]
														[if]
															[have_unit]
																x=$find_place[{find4}].x
																y=$find_place[{find4}].y
															[/have_unit]
															[then]
																[if]
																	[have_unit]
																		x=$find_place[{find5}].x
																		y=$find_place[{find5}].y
																	[/have_unit]
																	[then]
																		[if]
																			[have_unit]
																				x=$find_place[{find6}].x
																				y=$find_place[{find6}].y
																			[/have_unit]
																			[then]
																				[if]
																					[have_unit]
																						x=$find_place[{find7}].x
																						y=$find_place[{find7}].y
																					[/have_unit]
																					[then]
																						[unstore_unit]
																							variable=creep
																							find_vacant=yes
																						[/unstore_unit]
																					[/then]
																					[else]
																						[unstore_unit]
																							variable=creep
																							x=$find_place[{find7}].x
																							y=$find_place[{find7}].y
																						[/unstore_unit]
																					[/else]
																				[/if]
																			[/then]
																			[else]
																				[unstore_unit]
																					variable=creep
																					x=$find_place[{find6}].x
																					y=$find_place[{find6}].y
																				[/unstore_unit]
																			[/else]
																		[/if]
																	[/then]
																	[else]
																		[unstore_unit]
																			variable=creep
																			x=$find_place[{find5}].x
																			y=$find_place[{find5}].y
																		[/unstore_unit]
																	[/else]
																[/if]
															[/then]
															[else]
																[unstore_unit]
																	variable=creep
																	x=$find_place[{find4}].x
																	y=$find_place[{find4}].y
																[/unstore_unit]
															[/else]
														[/if]
													[/then]
													[else]
														[unstore_unit]
															variable=creep
															x=$find_place[{find3}].x
															y=$find_place[{find3}].y
														[/unstore_unit]
													[/else]
												[/if]
											[/then]
											[else]
												[unstore_unit]
													variable=creep
													x=$find_place[{find2}].x
													y=$find_place[{find2}].y
												[/unstore_unit]
											[/else]
										[/if]
									[/then]
									[else]
										[unstore_unit]
											variable=creep
											x=$find_place[{find1}].x
											y=$find_place[{find1}].y
										[/unstore_unit]
									[/else]
								[/if]
							[/then]
							[else]
								[unstore_unit]
									variable=creep
									x={x}
									y={y}
								[/unstore_unit]
							[/else]
						[/if]
						{VARIABLE_OP spawned_creeps add 1}
					[/do]
				[/while]
				{VARIABLE {number} 0}
			[/then]
		[/if]
	[/event]
#enddef
#define CW_HELP_MENU
	[set_menu_item]
		id=Zhelp
		description= _ "Help"
		[command]
			[message]
				speaker=narrator
				side_for=$side_number
				message= _ {Start_Message_new}
				[option]
					message= _ "close"
					[/option]
				[option]
					message= _ "FAQ"
					[command]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "<span color='#00FF00'>What is the goal of this game?</span>
<span size='small'>The goal is to kill either guard of the opposing team.</span>
<span color='#00FF00'>How do I enter the shop?</span>
<span size='small'>Move on it, right click on your hero, and select 'Enter Shop'.</span>
<span color='#00FF00'>How do I get gold?</span>
<span size='small'>Killing a creep gives your team 4 gold.  Killing an enemy hero gives 20.</span>
<span color='#00FF00'>What if I die?</span>
<span size='small'>You lose one turn, then start again in your team's cave.</span>
<span color='#00FF00'>What is that score counter for?</span>
<span size='small'>A team gets more powerful creeps every 15 score.  After 90, there will be no new creep types—they will just get stronger.</span>
<span color='#00FF00'>Why can't I buy a suit of armour?</span>
<span size='small'>You have already purchased a similar piece of armour and cannot wear any more of that kind.</span>
<span color='#00FF00'>Can I visit the enemy's shop?</span>
<span size='small'>No.</span>"
							[/message]
						[/command]
					[/option]
				[option]
					message= _ "changelog"
					[command]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "{~add-ons/Creep_War/changelog}"
						[/message]
					[/command]
				[/option]
			[/message]
		[/command]
	[/set_menu_item]
#enddef
