{~add-ons/Creep_War/macros/Macros.cfg}
#define Start_Message
"
Welcome to Creep War!
On this map, each player controls a single hero and fights for a team, East or West.  The game ends when one team kills the opposing Team Leader.  At the shop, you can buy upgrades for your hero, including HP, damage, movement, weapons, armour, and resistances.  Visiting the shop will also heal your hero completely.  Each turn, each of your team's guards summons a new creep.  The strength of the creeps created increases with your team's score.  Killing a creep gives your team +1 score; killing a Hero gives +3 score; simply attacking an opposing guard also gives +1 score. When your team kills a creep, everyone on your team gets 4 gold.  Whenever a hero dies, everyone on the opposing team gets 20 gold.  Killing a guard yields 100 gold, and it will no longer be able to create creeps.  If your hero dies, you will lose your next turn and start back in your team's cave.

Have Fun!

Creep War 0.3.00
Written by Blitzmerker and piezocuttlefish"
#enddef

#define create_CW_Leader team x y side
	[unit]
		type=Grand Marshal
		id=CW_Leader_{team}
		name=Team Leader
		side={side}
		x={x}
		y={y}
		random_traits=no
		canrecruit=yes
		[modifications]
			[object]
				[effect] 
					apply_to=hitpoints 
					increase_total=240
					heal_full=yes
				[/effect]
				[effect]
					apply_to=attack
					range=ranged
					increase_damage=12
					increase_attacks=1
				[/effect]
				[effect]
					apply_to=attack
					range=melee
					increase_damage=10
				[/effect]
				[effect]
					apply_to=max_experience
					increase=9999
				[/effect]
				[effect]
					apply_to=movement
					set=0
				[/effect]
			[/object]
		[/modifications]
		to_variable=leader_var
	[/unit]
	[set_variable]
		name=leader_var.alignment
		value=neutral
	[/set_variable]
	[unstore_unit]
		variable=leader_var
	[/unstore_unit]
#enddef
#define create_CW_Guard team number x y side
	[unit]
		type=Lieutenant
		id=CW_Guard_{team}{number}
		name=Guard
		side={side}
		x={x}
		y={y}
		random_traits=no
		[modifications]
			[object]
				[effect] 
					apply_to=hitpoints 
					increase_total=10
					heal_full=yes
				[/effect]
				[effect] 
					apply_to=attack
					range=melee
					increase_damage=-3
					increase_attacks=1
				[/effect]
				[effect]
					apply_to=attack
					range=ranged
					increase_damage=0
					increase_attacks=1
				[/effect]
				[effect]
					apply_to=max_experience
					increase=99920
				[/effect]
				[effect]
					apply_to=movement
					set=0
				[/effect]
				[effect]
					apply_to=resistance
					replace=true
					[resistance]
						blade=100
						cold=100
						fire=100
						impact=100
						pierce=100
						arcane=100
					[/resistance]
				[/effect]
			[/object]
		[/modifications]
		to_variable=guard_var
	[/unit]
	[set_variable]
		name=guard_var.alignment
		value=neutral
	[/set_variable]
	[unstore_unit]
		variable=guard_var
	[/unstore_unit]
#enddef
#define creep_die enemy1 enemy2 enemy3 kill team side
	[event]
		name=die
		first_time_only=no
		[filter]
			side={side}
			[not]
				type=Lieutenant
			[/not]
		[/filter]
		[gold]
			side={enemy1}
			amount=4
		[/gold]
		[gold]
			side={enemy2}
			amount=4
		[/gold]
		[gold]
			side={enemy3}
			amount=4
		[/gold]
		[set_variable]
			name=gold_{team}
			add=4
		[/set_variable]
		[set_variable]
			name={kill}
			add=1
		[/set_variable]
		[object]
			silent=yes
			[filter]
				id=CW_Guard_{team}1
			[/filter]
			[effect]
				apply_to=hitpoints
				increase_total=1
				increase=1
			[/effect]
		[/object]
		[object]
			silent=yes
			[filter]
				id=CW_Guard_{team}2
			[/filter]
			[effect]
				apply_to=hitpoints
				increase_total=1
				increase=1
			[/effect]
		[/object]
		[set_variable]
			name=guard_{team}_plus_hitpoints
			add=1
		[/set_variable]
		{CW_UPDATE_SCORE}
	[/event]
#enddef
#define CW_Guard_die enemy1 enemy2 enemy3 team_die number kill team
	[event]
		name=die
		first_time_only=no
		[filter]
			id=CW_Guard_{team_die}{number}
		[/filter]
		[gold]
			side={enemy1}
			amount=100
		[/gold]
		[gold]
			side={enemy2}
			amount=100
		[/gold]
		[gold]
			side={enemy3}
			amount=100
		[/gold]
		[set_variable]
			name=gold_{team}
			add=100
		[/set_variable]
		[set_variable]
			name={kill}
			add=1
		[/set_variable]
		[set_variable]
			name=CW_Guard_{team_die}{number}
			value=dead
		[/set_variable]
		[object]
			silent=yes
			[filter]
				id=CW_Guard_{team}1
			[/filter]
			[effect]
				apply_to=hitpoints
				increase_total=1
				increase=1
			[/effect]
		[/object]
		[object]
			silent=yes
			[filter]
				id=CW_Guard_{team}2
			[/filter]
			[effect]
				apply_to=hitpoints
				increase_total=1
				increase=1
			[/effect]
		[/object]
		[set_variable]
			name=guard_{team}_plus_hitpoints
			add=1
		[/set_variable]
		{CW_UPDATE_SCORE}
	[/event]
#enddef
#define CW_Leader_die team winside1 winside2 winside3 x1 x2 x3 y side1 side2 side3 side
	[event]
		name=die
		[filter]
			side={side}
			id=CW_Leader_{team}
		[/filter]
		[if]
			[variable]
				name=hero_{winside1}
				equals=dead
			[/variable]
			[or]
				[variable]
					name=hero_{winside1}
					equals=dead_wait
				[/variable]
			[/or]
			[then]
				[unstore_unit]
					variable=dead_hero_{winside1}
					x={x1}
					y={y}
					find_vacant=yes
				[/unstore_unit]
			[/then]
		[/if]
		[if]
			[variable]
				name=hero_{winside2}
				equals=dead
			[/variable]
			[or]
				[variable]
					name=hero_{winside2}
					equals=dead_wait
				[/variable]
			[/or]
			[then]
				[unstore_unit]
					variable=dead_hero_{winside2}
					x={x2}
					y={y}
					find_vacant=yes
				[/unstore_unit]
			[/then]
		[/if]
		[if]
			[variable]
				name=hero_{winside3}
				equals=dead
			[/variable]
			[or]
				[variable]
					name=hero_{winside3}
					equals=dead_wait
				[/variable]
			[/or]
			[then]
				[unstore_unit]
					variable=dead_hero_{winside3}
					x={x3}
					y={y}
					find_vacant=yes
				[/unstore_unit]
			[/then]
		[/if]
		[kill]
			side={side1}
		[/kill]
		[kill]
			side={side}
		[/kill]
		[kill]
			side={side2}
		[/kill]
		[kill]
			side={side3}
		[/kill]
	[/event]
#enddef
#define new_creep greater_than_equal_to less_than_equal_to kill team number type1 type2 type3 x y find1 find2 find3 find4 find5 find6 increase_damage increase_strikes increase_mp side
	[event]
		name=side turn
		first_time_only=no
		[if]
			[not]
				[variable]
					name=team_{team}
					equals=dead
				[/variable]
			[/not]
			[variable]
				name=side_number
				equals={side}
			[/variable]
			[variable]
				name=CW_Guard_{team}{number}
				equals=alive
			[/variable]
			[variable]
				name={kill}
				greater_than_equal_to={greater_than_equal_to}
			[/variable]
			[variable]
				name={kill}
				less_than_equal_to={less_than_equal_to}
			[/variable]
			[then]
				[set_variable]
					name={team}{number}
					rand=1,2,3
				[/set_variable]
				[if]
					[variable]
						name={team}{number}
						equals=1
					[/variable]
					[then]
						[unit]
							side={side}
							type={type1}
							x={x}
							y={y}
							random_gender=yes
							[modifications]
								[object]
									silent=yes
									[effect]
										apply_to=zoc
										value=no
									[/effect]
								[/object]
							[/modifications]
							to_variable=creep
						[/unit]
					[/then]
				[/if]
				[if]
					[variable]
						name={team}{number}
						equals=2
					[/variable]
					[then]
						[unit]
							side={side}
							type={type2}
							x={x}
							y={y}
							random_gender=yes
							[modifications]
								[object]
									silent=yes
									[effect]
										apply_to=zoc
										value=no
									[/effect]
								[/object]
							[/modifications]
							to_variable=creep
						[/unit]
					[/then]
				[/if]
				[if]
					[variable]
						name={team}{number}
						equals=3
					[/variable]
					[then]
						[unit]
							side={side}
							type={type3}
							x={x}
							y={y}
							random_gender=yes
							[modifications]
								[object]
									silent=yes
									[effect]
										apply_to=zoc
										value=no
									[/effect]
								[/object]
							[/modifications]
							to_variable=creep
						[/unit]
					[/then]
				[/if]
				[set_variable]
					name=addhp
					value={less_than_equal_to}
				[/set_variable]
				[set_variable]
					name=addhp
					add=-90
				[/set_variable]
				[set_variable]
					name=adddmg
					value=0
				[/set_variable]
				[set_variable]
					name=addatk
					value=0
				[/set_variable]
				[set_variable]
					name=addmp
					value=0
				[/set_variable]
				[if]
					[variable]
						name=addhp
						greater_than=0
					[/variable]
					[then]
						[set_variable]
							name=creep.max_hitpoints
							add=$addhp
						[/set_variable]
						[set_variable]
							name=creep.hitpoints
							add=$addhp
						[/set_variable]
						[set_variable]
							name=adddmg
							value=$addhp
						[/set_variable]
						[set_variable]
							name=addmp
							value=$addhp
						[/set_variable]
						[set_variable]
							name=adddmg
							multiply=0.125
						[/set_variable]
						[set_variable]
							name=addatk
							value=$addhp
						[/set_variable]
						[set_variable]
							name=addatk
							multiply=0.05
						[/set_variable]
						[set_variable]
							name=addmp
							multiply=0.05
						[/set_variable]
						[set_variable]
							name=creep.max_moves
							add=$addmp
						[/set_variable]
						[set_variable]
							name=creep.moves
							add=$addhp
						[/set_variable]
					[/then]
				[/if]
					
				{FOREACH creep.attack i}
					{VARIABLE_OP creep.attack[$i].damage add {increase_damage}}
					{VARIABLE_OP creep.attack[$i].damage add $adddmg}
				{NEXT i}
				{FOREACH creep.attack i}
					{VARIABLE_OP creep.attack[$i].number add {increase_strikes}}
					{VARIABLE_OP creep.attack[$i].number add $addatk}
				{NEXT i}
				{VARIABLE_OP creep.max_moves add {increase_mp}}
				[store_locations]
					x={x}
					y={y}
					radius=1
					variable=find_place
				[/store_locations]
				[if]
					[have_unit]
						x=$find_place[{find1}].x
						y=$find_place[{find1}].y
					[/have_unit]
					[then]
						[if]
							[have_unit]
								x=$find_place[{find2}].x
								y=$find_place[{find2}].y
							[/have_unit]
							[then]
								[if]
									[have_unit]
										x=$find_place[{find3}].x
										y=$find_place[{find3}].y
									[/have_unit]
									[then]
										[if]
											[have_unit]
												x=$find_place[{find4}].x
												y=$find_place[{find4}].y
											[/have_unit]
											[then]
												[if]
													[have_unit]
														x=$find_place[{find5}].x
														y=$find_place[{find5}].y
													[/have_unit]
													[then]
														[if]
															[have_unit]
																x=$find_place[{find6}].x
																y=$find_place[{find6}].y
															[/have_unit]
															[then]
																[unstore_unit]
																	variable=creep
																	find_vacant=yes
																[/unstore_unit]
															[/then]
															[else]
																[unstore_unit]
																	variable=creep
																	x=$find_place[{find6}].x
																	y=$find_place[{find6}].y
																[/unstore_unit]
															[/else]
														[/if]
													[/then]
													[else]
														[unstore_unit]
															variable=creep
															x=$find_place[{find5}].x
															y=$find_place[{find5}].y
														[/unstore_unit]
													[/else]
												[/if]
											[/then]
											[else]
												[unstore_unit]
													variable=creep
													x=$find_place[{find4}].x
													y=$find_place[{find4}].y
												[/unstore_unit]
											[/else]
										[/if]
									[/then]
									[else]
										[unstore_unit]
											variable=creep
											x=$find_place[{find3}].x
											y=$find_place[{find3}].y
										[/unstore_unit]
									[/else]
								[/if]
							[/then]
							[else]
								[unstore_unit]
									variable=creep
									x=$find_place[{find2}].x
									y=$find_place[{find2}].y
								[/unstore_unit]
							[/else]
						[/if]
					[/then]
					[else]
						[unstore_unit]
							variable=creep
							x=$find_place[{find1}].x
							y=$find_place[{find1}].y
						[/unstore_unit]
					[/else]
				[/if]
			[/then]
		[/if]
	[/event]
#enddef
#define help_menu
	[set_menu_item]
		id=Zhelp
		description= _ "Help"
		[command]
			[message]
				speaker=narrator
				side_for=$side_number
				message= _ {Start_Message}
				[option]
					message= _ "close"
				[/option]
				[option]
					message= _ "FAQ"
					[command]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "<span color='#00FF00'>What is the goal of this game?</span>
<span size='small'>The goal is to kill the opposing Team Leader.</span>
<span color='#00FF00'>How do I enter the shop?</span>
<span size='small'>Move on it, right click on your hero, and select 'Enter Shop'.</span>
<span color='#00FF00'>How do I get gold?</span>
<span size='small'>Killing a creep gives your team 4 gold.  Killing an enemy hero gives 20.  Killing a guard gives 100.</span>
<span color='#00FF00'>What if I die?</span>
<span size='small'>You lose one turn, then start again in your team's cave.</span>
<span color='#00FF00'>What is that score counter for?</span>
<span size='small'>A team gets more powerful creeps every 15 score.  After 90, there will be no new creep types—they will just get stronger.</span>
<span color='#00FF00'>Why can't I buy a suit of armour?</span>
<span size='small'>You start with 10 resistance upgrades, and buying a suit of armour costs some or all of those.</span>
<span color='#00FF00'>Can I visit the enemy's shop?</span>
<span size='small'>No.</span>"
						[/message]
					[/command]
				[/option]
				[option]
					message= _ "changelog"
					[command]
						[message]
							speaker=narrator
							side_for=$side_number
							message= _ "{~add-ons/Creep_War/changelog}"
						[/message]
					[/command]
				[/option]
			[/message]
		[/command]
	[/set_menu_item]
#enddef
